---
layout:     post
title:      App Crash统计分析
category: blog
description: 虽然应用上架前会经过大量的测试，不过一些不易察觉的bug在上架后导致crash还是时有发生的，对这些问题统计分析很有必要
---
当设备上的app闪退时，系统会生成一个crash日志，日子中保存着每个正在执行线程的完整堆栈信息和内存映像，通过解析这些信息来定位crash发生是的代码逻辑，从而找到app闪退的原因。通过crash的来源有两种：
1.违反系统规则导致的crash。 
2.代码逻辑BUG导致的crash。

### 违反系统规则产生crash有三种情况

1. 内存报警闪退
每个app的可用内存都是被限制的，当系统检测到内存过低时会做出相应的处理，首先系统会发出低内存降到通知，尝试回收一些内存；如果情况没有得到足够的改善，然后系统会终止后台应用以回收更多内存；最后，如果内存还是不足，那么正在运行的应用可能会被终止掉。
1. 响应超时
当应用程序对一些特定的事件（启动、挂起、恢复、结束）响应不及时，iOS的Watchdog会把应用干掉，并生成一份相应的crash日志。这些事件与下列AppDelegate中的方法对应，
```
application:didFinishLaunchingWithOptions:
applicationWillResignActive:
applicationDidEnterBackground:
applicationWillEnterForeground:
applicationDidBecomeActive:
applicationWillTerminate:
```
当遇到Watchdog日志时，可以检查这几个方法是否有比较重的阻塞UI的动作。

1. 用户强制退出
通过双击Home键，然后关闭应用程序，这种强制退出不会产生crash日志，因为双击Home键后，所有的应用程序都处于后台状态，而系统随时都有可能关闭后台进程。当应用阻塞界面并停止响应时才会产生crash日志。只有当用户先按住电源键，然后在出现“滑动关机”的界面时，直接关机才会把当前应用终止掉，并且产生一份crash日志。

### 应用逻辑产生Bug
大部分的crash日志的产生都是因为应用中的Bug。常见的crash原因基本是代码逻辑和资源问题，比如数组越界，访问野指针或者资源不存在等等（由于swift中的“？”和“！”的引入，这种常见错误的出现大大得到了改善）。

#### crash日志的收集
1. 在升级到Xcode7后，苹果直接集成了crash的收集，让整个过程也变得简单多了。
![](/images/crashLogImage.png)
选中在每次打包应用后生成的版本文件对应的Crashes就会显示对应的错误信息，然后点击右边的Open in Project会直接跳转到项目中的crash的所在行。
1. 友盟统计也是使用率很高的统计平台，也是根据系统产生的crash日志进行提取或封装，然后将crash文件上传到对应的服务端进行解析处理，而且能到获得更加直观的数据处理结果。

更详细的可参看博文：
[iOS调试之 crash log分析](http://www.jianshu.com/p/12a2402b29c2)